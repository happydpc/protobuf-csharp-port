# Command line syntax #

Versions prior to 2.3 just take a list of binary protocol message description files, as generated by `protoc` with the `--descriptor_set_out` command line parameter. You need to include imports in the generated file (with the `--include_imports`) parameter, and **all** messages will be generated. For example:

```
protogen addressbook.protobin
```

The address book example in the [getting started guide](GettingStarted.md) walks you through this.

# Command line arguments #

As of version 2.3 and later you can now specify any of the CSharp file descriptor options (see [CSharpFileOptions](http://code.google.com/p/protobuf-csharp-port/source/browse/protos/google/protobuf/csharp_options.proto#7)).  To specify these options from the command line use the following syntax:
```
ProtoGen.exe -{OPTION}={VALUE}
```

The following options are available:
| **Option** | **Type** | **Description** |
|:-----------|:---------|:----------------|
| **namespace** | String | Namespace for generated classes; defaults to the package. |
| **umbrella\_classname** | String | Name of the "umbrella" class used for metadata about all the messages within this file. Default is based on the name of the file. |
| **public\_classes** | Bool | Whether classes should be public (true) or internal (false). |
| **nest\_classes** | Bool | Whether to nest messages within a single umbrella class (true) or create the umbrella class as a peer, with messages as top-level classes in the namespace (false). |
| **code\_contracts** | Bool | Generate appropriate support for Code Contracts (Ongoing; support should improve over time) |
| **expand\_namespace\_directories** | Bool | Create subdirectories for namespaces, e.g. namespace "Foo.Bar" would generate files within {output directory}/Foo/Bar. |
| **cls\_compliance** | Bool | Generate attributes indicating non-CLS-compliance. |
| **file\_extension** | String | The extension that should be appended to the umbrella\_classname when creating files. |
| **umbrella\_namespace** | String | A nested namespace for the umbrella class.  Helpful for name collisions caused by umbrella\_classname conflicting with an existing type.  This will be automatically set to 'Proto' if a collision is detected with types being generated.  This value is ignored when nest\_classes is true. |
| **output\_directory** | String | The output path for the source file(s) generated, default is the current directory. |
| **ignore\_google\_protobuf** | Bool | Will ignore the type generations and remove dependencies for the descriptor proto files that declare their package to be "google.protobuf".  This is useful to disable the generation of CsharpOptions.cs. |

In addition to the descriptor options, the following options are also available:
| **Option** | **Type** | **Description** |
|:-----------|:---------|:----------------|
| **line\_break** | Windows|Unix|Default | Configures the generator to use a specific type of line ending in the source files created. |

# Running ProtoGen.exe with .proto files #

For ease of use ProtoGen can now invoke protoc.exe for you simply by providing the proto files and optionally protoc.exe arguments on the command line.  To specify options for protoc.exe use the following format only:
```
ProtoGen.exe --{PROTOC-OPTION}={VALUE}
```

**Note:** You MUST use two dashes '-' for protoc options.  To allow ProtoGen to call protoc.exe, protoc.exe must be located in the system PATH, or in the same directory.

The following arguments are generally used with protoc.exe:
| **Option** | **Type** | **Description** |
|:-----------|:---------|:----------------|
| **proto\_path** | PATH | Specify the directory in which to search for imports.  May be specified multiple times; directories will be searched in order.  If not given, the current working directory is used. |
| **descriptor\_set\_out** | PATH | Writes a FileDescriptorSet (a protocol buffer, defined in descriptor.proto) containing all of the input files to FILE.  If not specified the buffer will be removed after code generation. |
| **include\_imports** | n/a | When using --descriptor\_set\_out, also include all dependencies of the input files in the set, so that the set is self-contained. |
| **error\_format** | gcc|msvs | Set the format in which to print errors. FORMAT may be 'gcc' (the default) or 'msvs' (Microsoft Visual Studio format). |

# Examples #

For this example we will be building the protos\tutorial\addressbook.proto file located in the project.

**Manually run both protoc.exe and protogen.exe**
```
lib\protoc.exe --proto_path=./protos protos/tutorial/addressbook.proto --include_imports --descriptor_set_out=addressbook.pb
src\ProtoGen\bin\Debug\ProtoGen.exe addressbook.pb -output_directory=protos\tutorial
```

**Run both protoc.exe and protogen.exe with a single line**
```
src\ProtoGen\bin\Debug\ProtoGen.exe --proto_path=./protos protos/tutorial/addressbook.proto --include_imports -output_directory=protos\tutorial
```

# Integration with Visual Studio #

While neither ProtoGen nor protoc.exe directly support Visual Studio integration it is possible with 3rd-party tools.  So here is a quick run-down on integration with my own tool:

  1. Start by downloading one of the binary packages from the [csharptest-net](http://code.google.com/p/csharptest-net/downloads/list).
  1. Extract the "CmdTool.exe" file to a location on your hard drive.
  1. Follow the [Visual Studio Registration](http://help.csharptest.net/?CmdToolVisualStudio.html) steps by running "CmdTool.exe REGISTER".
  1. Copy one of the [ProtoGen Sample Configurations](http://help.csharptest.net/?CmdToolIntegrateProtoGen.html) to a file called "CmdTool.config" and place in the root directory containing your .proto files.
  1. Open Visual Studio and add the .proto files to your project.
  1. Right-click the .proto file and select Properties, then enter "CmdTool" under the "Custom Tool" property.